<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stuffed Animal Mixer</title>

<style>
  body {
    font-family: "Comic Sans MS", "Fredoka", sans-serif;
    background: linear-gradient(#e3fff1, #c7e8ff);
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    font-size: 40px;
    margin-bottom: 20px;
    color: #1a92b6;
    text-shadow: 2px 2px #ffffff;
  }

  /* Layout container */
  #layout {
    display: flex;
    gap: 30px;
    width: 100%;
    max-width: 1200px;
    justify-content: center;
  }

  /* Tabs */
  #tabs button {
    background: #6cd4b4;
    border: none;
    padding: 10px;
    border-radius: 12px;
    font-size: 16px;
    margin-bottom: 10px;
    cursor: pointer;
    font-weight: bold;
    color: white;
    width: 150px;
    box-shadow: 0 3px 0 #4aa88b;
    transition: transform 0.1s;
  }

  #tabs button:hover { transform: scale(1.07); }

  /* Carousel box */
  #carousel-area {
    width: 240px;
  }

  .carousel {
    display: none;
    flex-direction: column;
    align-items: center;
    background: #ffffffaa;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 4px 10px #00000020;
    border: 3px dashed #7fd6ff;
  }

  .carousel img {
    width: 160px;
    height: 160px;
    background: white;
    border: 3px solid #b8edff;
    border-radius: 15px;
    padding: 10px;
    margin-bottom: 10px;
  }

  .carousel button {
    background: #55c2ff;
    box-shadow: 0 3px 0 #3a8cb8;
  }

  /* =============== PREVIEW AREA (responsive) =============== */
  #preview-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #preview-area {
    position: relative;
    width: 100%;
    max-width: 520px;   /* YOUR CHOSEN OPTION C */
    aspect-ratio: 520 / 640;
    overflow: hidden;
    background: #ffffffaa;
    border: 4px solid #7fe6c9;
    border-radius: 20px;
    box-shadow: 0 5px 15px #00000030;
  }

  /* Base coordinate system (520Ã—640), scaled uniformly */
  .part {
    position: absolute;
    transform-origin: top left;
  }

  /* Your exact coordinates */
  #left-leg  { width:260px; top:400px; left:50px;  z-index:1; }
  #right-leg { width:260px; top:400px; left:210px; z-index:1; }

  #body      { width:360px; top:165px; left:80px;  z-index:2; }

  #left-arm  { width:240px; top:210px; left:-10px; z-index:3; }
  #right-arm { width:240px; top:210px; left:290px; z-index:3; }

  #head      { width:360px; top:-30px; left:80px;  z-index:4; }

  /* Buttons under preview */
  #action-buttons {
    margin-top: 20px;
    display: flex;
    gap: 20px;
  }

  #action-buttons button {
    background: #6cd4b4;
    padding: 12px 20px;
    border-radius: 15px;
    font-size: 18px;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 3px 0 #4aa88b;
  }
</style>
</head>

<body>
<h1>Stuffed Animal Mixer</h1>

<div id="layout">

  <!-- TAB BUTTONS -->
  <div id="tabs">
    <button onclick="showTab('head')">Head</button>
    <button onclick="showTab('body')">Body</button>
    <button onclick="showTab('leftArm')">Left Arm</button>
    <button onclick="showTab('rightArm')">Right Arm</button>
    <button onclick="showTab('leftLeg')">Left Leg</button>
    <button onclick="showTab('rightLeg')">Right Leg</button>
  </div>

  <!-- CAROUSEL -->
  <div id="carousel-area">
    <div class="carousel" id="carousel-head">
      <h3>Head</h3>
      <img id="carousel-head-img">
      <button onclick="prev('head')">Prev</button>
      <button onclick="next('head')">Next</button>
    </div>

    <div class="carousel" id="carousel-body">
      <h3>Body</h3>
      <img id="carousel-body-img">
      <button onclick="prev('body')">Prev</button>
      <button onclick="next('body')">Next</button>
    </div>

    <div class="carousel" id="carousel-leftArm">
      <h3>Left Arm</h3>
      <img id="carousel-leftArm-img">
      <button onclick="prev('leftArm')">Prev</button>
      <button onclick="next('leftArm')">Next</button>
    </div>

    <div class="carousel" id="carousel-rightArm">
      <h3>Right Arm</h3>
      <img id="carousel-rightArm-img">
      <button onclick="prev('rightArm')">Prev</button>
      <button onclick="next('rightArm')">Next</button>
    </div>

    <div class="carousel" id="carousel-leftLeg">
      <h3>Left Leg</h3>
      <img id="carousel-leftLeg-img">
      <button onclick="prev('leftLeg')">Prev</button>
      <button onclick="next('leftLeg')">Next</button>
    </div>

    <div class="carousel" id="carousel-rightLeg">
      <h3>Right Leg</h3>
      <img id="carousel-rightLeg-img">
      <button onclick="prev('rightLeg')">Prev</button>
      <button onclick="next('rightLeg')">Next</button>
    </div>
  </div>

  <!-- PREVIEW AREA -->
  <div id="preview-wrapper">
    <div id="preview-area">
      <img id="head"      class="part">
      <img id="body"      class="part">
      <img id="left-arm"  class="part">
      <img id="right-arm" class="part">
      <img id="left-leg"  class="part">
      <img id="right-leg" class="part">
    </div>

    <!-- Buttons under preview -->
    <div id="action-buttons">
      <button onclick="randomizeAll()">Randomize All</button>
      <button onclick="downloadCreature()">Download</button>
    </div>
  </div>

</div>

<script>
let parts = {};
let index = { head:0, body:0, leftArm:0, rightArm:0, leftLeg:0, rightLeg:0 };

const folderMap = {
  head: "img/heads/",
  body: "img/bodies/",
  leftArm: "img/arms/left/",
  rightArm: "img/arms/right/",
  leftLeg: "img/legs/left/",
  rightLeg: "img/legs/right/"
};

/* Load parts.json */
fetch("parts.json")
  .then(r => r.json())
  .then(json => {
    parts = json;
    initAll();
  });

function initAll() {
  for (const p in parts) update(p);
  showTab("head");
  applyPreviewScaling();
}

/* Uniform scaling system */
function applyPreviewScaling() {
  const baseWidth = 520;
  const area = document.getElementById("preview-area");
  const scale = area.clientWidth / baseWidth;

  document.querySelectorAll(".part").forEach(img => {
    img.style.transform = `scale(${scale})`;
  });
}

window.addEventListener("resize", applyPreviewScaling);

/* Updates a part image */
function update(part) {
  const file = parts[part][index[part]];
  const full = folderMap[part] + file;

  document.getElementById(`carousel-${part}-img`).src = full;

  const id = part.replace(/([A-Z])/g,"-$1").toLowerCase();
  document.getElementById(id).src = full;

  applyPreviewScaling();
}

/* Carousel navigation */
function next(part) {
  index[part] = (index[part] + 1) % parts[part].length;
  update(part);
}
function prev(part) {
  index[part] = (index[part] - 1 + parts[part].length) % parts[part].length;
  update(part);
}

/* Tab switching */
function showTab(part) {
  document.querySelectorAll(".carousel").forEach(c => c.style.display="none");
  document.getElementById("carousel-" + part).style.display = "flex";
}

/* Randomize button */
function randomizeAll() {
  for (const p in parts) {
    index[p] = Math.floor(Math.random() * parts[p].length);
    update(p);
  }
}

/* Download (simple version - screenshot) */
function downloadCreature() {
  const area = document.getElementById("preview-area");

  html2canvas(area, {
    backgroundColor: null,
    scale: 2
  }).then(canvas => {
    const link = document.createElement("a");
    link.download = "my-creature.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

</script>

</body>
</html>
